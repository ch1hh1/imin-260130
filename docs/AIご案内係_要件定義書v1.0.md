## 要件定義書：AIご案内係（生成AI×RAG カスタマーサポート／総務・受付向け）

**版数**: v1.0  
**作成日**: 2026-01-30  
**作成者**: （記入）  

---

## 1. 文書の目的

- **目的**: 企画書「AIご案内係（v1.2）」に基づき、システム開発・導入・運用の共通認識を確立するための要件を明文化する。
- **対象読者**: 事業企画担当、開発チーム、インフラ担当、情報システム部門、セキュリティ担当、運用担当。
- **本書で定義する範囲**
  - Webアプリケーション（AIご案内係フロント＋管理画面＋API）
  - Difyを用いたRAG環境およびLM Studio連携
  - ローカル／閉域環境での提供に必要なインフラ前提（docker compose 単位）

---

## 2. システム概要

- **システム名（仮）**: AIご案内係
- **分類**: B2B向けカスタマーサポートサービス（総務・受付・社内ヘルプデスク向け）
- **概要**
  - 生成AIとRAGを用いて、社内問い合わせの一次対応を自動化・効率化する。
  - 顧客企業固有の規程・マニュアル・FAQ・業務手順を参照し、属人性を排除しつつ応対品質を平準化する。
  - Difyのナレッジ機能をRAG運用基盤として活用し、LM StudioのOpenAI互換APIを通じてローカルLLMを利用する。
- **導入形態**
  - 顧客環境内（オンプレミス／閉域ネットワーク／ローカル）に限定し、docker compose によるパッケージ提供を前提とする。

---

## 3. 対象範囲と前提条件

### 3.1 対象範囲

- 総務・受付・社内ヘルプデスクなど、社内からの問い合わせ一次対応業務。
- まずは総務部門の「定番問い合わせ」等、FAQ化しやすい領域を優先。
- Step1〜Step3の段階導入モデル（FAQボット → 限定RAG → 全社RAG）を前提とした構成。

### 3.2 非対象範囲（本フェーズでは対象外）

- 対話結果をトリガーとした業務システムへの自動登録／ワークフロー実行（例：チケット発行ツールとの双方向連携）。
- 音声入出力インタフェース（電話、音声ボットなど）。
- クラウドSaaSとしてのマルチテナント提供。

### 3.3 前提条件

- 顧客側に docker compose が動作可能なサーバ環境が用意されること。
- LM Studio を動作させるためのマシンリソース（GPU/CPU、メモリ、ストレージ）が顧客側で準備されること。
- 顧客側でのネットワーク／セキュリティポリシーに基づき、必要なポート開放と名前解決が行われること。

---

## 4. 利用者・ステークホルダー

### 4.1 利用者区分

- **一般利用者（エンドユーザー）**
  - 社内の問い合わせを行う社員（総務への問い合わせなど）。
  - AIご案内係フロント画面から質問を入力し、回答を参照する。
- **管理者**
  - FAQ／ナレッジの登録・更新・削除、公開／非公開の管理を行う。
  - 利用状況を分析し、運用ルールやナレッジを改善する責任を持つ。
- **編集者**
  - 管理者の承認を前提として、ナレッジの作成・修正案の登録を行う。
- **閲覧者**
  - 利用ログやナレッジを参照するが、編集はできない。

### 4.2 ステークホルダー

- 顧客企業の情報システム部門／セキュリティ部門
- 顧客企業の総務・受付・社内ヘルプデスク部門
- 提供側の開発・運用チーム
- 経営層・事業責任者

---

## 5. 機能要件

### 5.1 フロント機能（AIご案内係：一般利用者向け）

- **[FR-001] 質問入力**
  - 利用者はテキストで質問を入力できること。
  - 入力文字数の上限（例：4000文字）を設け、上限値は設定で変更可能とする【要調整】。
- **[FR-002] 回答表示**
  - システムは質問に対する回答テキストを表示すること。
  - 回答とあわせて、参照したナレッジまたは文書のタイトル・概要を表示できること（根拠提示）。
- **[FR-003] 参照元（根拠）の提示**
  - 回答に利用されたナレッジの一覧（タイトル、カテゴリ、版、改定日、URLまたはID）を回答と共に表示できること。
  - 参照元の表示有無を設定で切り替え可能とする【要検討】。
- **[FR-004] 追加質問（会話継続）**
  - 利用者は直前の回答内容を文脈として、追加の質問を行えること。
  - セッション単位で会話履歴を保持し、一定時間（例：30分）操作がない場合はセッションを終了する。
- **[FR-005] ガードレール（禁止トピック制御）**
  - 禁止トピック（例：公序良俗に反する内容、特定個人情報の推測依頼など）については、回答を行わず定型メッセージを返すこと。
  - 禁止トピックの定義は管理画面から設定・更新できること【要検討】。
- **[FR-006] 免責表示**
  - 画面上に「回答は参考情報であり、最終判断は利用者が行う」旨の免責文言を表示できること。
  - 文言は顧客毎に変更可能とする。

### 5.2 管理画面機能

- **[FR-101] FAQ／ナレッジ登録**
  - 管理者・編集者は、以下の属性を持つナレッジを登録できること。
    - ワード（タイトル）
    - 詳細（本文）
    - カテゴリ
    - タグ
    - 改定日
    - 版
  - ナレッジは複数のカテゴリ・タグを持てること。
- **[FR-102] ナレッジ承認フロー**
  - ナレッジには「下書き」「レビュー中」「公開」「アーカイブ」等の状態を持たせる。
  - 編集者は「下書き」状態で登録し、管理者がレビュー／承認して「公開」に変更できること。
- **[FR-103] 検索・一覧・編集**
  - 管理画面でナレッジ一覧を表示し、以下の条件で検索・絞り込みができること。
    - キーワード
    - カテゴリ／タグ
    - 改定日／更新日
    - 状態（下書き／公開／アーカイブなど）
  - 一覧および詳細画面から、ナレッジの編集・アーカイブが行えること。
- **[FR-104] 利用状況分析**
  - 以下の指標を管理画面から参照できること。
    - 質問件数（期間・カテゴリ別）
    - 一次解決率（人手介入なしで完了した割合）
    - 未回答率・不適切回答率（管理者によるフラグ付与等で集計）
    - 上位質問カテゴリ・頻出キーワード
- **[FR-105] 権限管理**
  - ロール（管理者／編集者／閲覧者／一般利用者）ごとにアクセス可能な画面・操作を制御できること。
  - ロールの割り当てはユーザー単位で設定可能とする。

### 5.3 RAG運用機能（Dify連携）

- **[FR-201] ドキュメント投入**
  - FAQ、規程、マニュアル等のドキュメントをDifyナレッジに投入できること。
  - 対応するファイル形式（PDF、Word、テキストなど）は別途仕様として整理する【要検討】。
- **[FR-202] メタデータ付与**
  - ドキュメントに対し、以下のメタデータを付与できること。
    - 部署
    - 版
    - 適用範囲（対象部門／対象拠点など）
  - メタデータは検索・フィルタリングに利用されること。
- **[FR-203] インデックス更新**
  - 新規／更新／削除されたナレッジが、一定時間内（例：5〜15分）にRAG検索結果へ反映されること。
  - インデックス更新のタイミング・頻度は設定で調整可能とする【要検討】。

### 5.4 ログ・監査機能

- **[FR-301] 会話ログ記録**
  - ユーザーID（または匿名ID）、質問内容、回答内容、タイムスタンプ、参照ナレッジID等をログとして記録すること。
  - ログ保持期間は設定で変更できること（例：90日、180日、365日）。
- **[FR-302] 操作ログ**
  - ナレッジの登録・更新・削除、状態変更（下書き→公開など）、権限変更などの操作をユーザーIDと共に記録すること。
- **[FR-303] エクスポート**
  - 会話ログ／操作ログをCSV等でエクスポートできること【要検討】。

---

## 6. 非機能要件

### 6.1 性能・スケーラビリティ

- **[NFR-001] 応答時間**
  - 通常負荷時（同時接続数が想定範囲内）において、質問送信から初回回答表示までの時間を目標値○秒以内とする【要定義】。
- **[NFR-002] 同時接続**
  - 想定同時利用者数（例：20〜50ユーザー）を前提に、性能要件を検証する。
  - それ以上の同時接続に対応する場合は、スケールアウト方式を別途検討する。

### 6.2 可用性

- **[NFR-003] 稼働時間**
  - 営業時間内（例：平日 9:00〜18:00）の連続稼働を前提とし、深夜帯にメンテナンス時間を確保できるものとする。
- **[NFR-004] 障害時対応**
  - コンテナ単位で再起動することで復旧可能な構成とする。
  - 重大障害時には、顧客側運用チームによる復旧手順書に従うものとする（手順書は提供側が作成）。

### 6.3 信頼性・保守性

- **[NFR-005] ログ保全**
  - ログは一定期間保持し、バックアップ対象とする。
- **[NFR-006] バージョン管理**
  - Laravelアプリ、Dify構成、ベクターストアスキーマ等にバージョンを付与し、アップデート時に変更点を明示する。

### 6.4 ユーザビリティ

- **[NFR-007] UI/UX**
  - 一般的なWebブラウザ（最新版のChrome/Edge等）から利用可能であること。
  - 検索・フィルタリング・ナレッジ登録の操作が直感的に行えるUIとする。

---

## 7. システム構成要件

### 7.1 構成概要

- Webアプリ: Laravel（フロントUI＋管理画面＋APIを統合）
- AIオーケストレーション: Dify（セルフホスト、RAG／ワークフロー）
- 生成AIモデル: LM Studio（ローカルLLM、OpenAI互換API）
- ベクターストア: Difyが要求する構成（例: Weaviate 等）
- データベース: MySQL（FAQ、メタ情報、ログ等）
- リバースプロキシ: 必要に応じてTLS終端・ルーティングを提供

### 7.2 コンテナ構成（docker compose想定）

- laravel-app: Laravel本体
- mysql: 業務DB
- dify-*: Dify一式（API/Worker等）
- vector-store: ベクターストア
- reverse-proxy: TLS終端／ルーティング（必要な場合）
- LM Studio: 顧客環境で別途起動し、OpenAI互換APIとして接続

---

## 8. 外部インタフェース要件

### 8.1 LM Studio API連携

- **[IF-001] 接続方式**
  - OpenAI互換REST APIにより接続する。
  - エンドポイントURL、APIキー等は設定ファイルまたは環境変数で管理する。

### 8.2 Dify連携

- **[IF-002] ナレッジ・ワークフロー連携**
  - LaravelアプリからDify APIを呼び出し、RAG検索およびプロンプト生成を行う。
  - Dify側プロジェクトID／ナレッジID等は設定値として管理する。

### 8.3 認証基盤連携（オプション）

- **[IF-003] SSO連携【オプション要件】**
  - 顧客のディレクトリサービス（例：Active Directory、IdP）とのSSO連携をオプションとして検討する。
  - 具体的な方式（SAML/OIDC等）は個別案件で定義する。

---

## 9. データ要件

- **[DATA-001] ナレッジデータ**
  - FAQ、規程、マニュアル等をテキストベースで保持する。
  - 版管理、改定日、適用範囲等の属性を保持する。
- **[DATA-002] ログデータ**
  - 会話ログ、操作ログ、システムログを保持し、必要に応じてバックアップ対象とする。
- **[DATA-003] 個人情報の取扱い**
  - 個人情報・機微情報の入力を極力避けるよう、画面上に入力ガイドを表示する。
  - それでも入力された場合の取り扱い（マスキング・保持期間）を運用ルールとして定義する。

---

## 10. セキュリティ要件

### 10.1 アクセス制御

- **[SEC-001] RBAC**
  - ロールベースアクセス制御により、画面・機能単位のアクセス権を制御する。
- **[SEC-002] 多要素認証（MFA）【要検討】**
  - 管理画面へのアクセスに対してMFAを導入できる構成を検討する。
- **[SEC-003] IP制限【要検討】**
  - 管理画面へのアクセス元IPアドレスを制限できるようにする。

### 10.2 監査・ログ

- **[SEC-004] 操作ログ**
  - ナレッジ改定履歴、権限変更など、重要操作の履歴を保持する。
- **[SEC-005] ナレッジ改定履歴**
  - ナレッジごとに版履歴を保持し、いつ・誰が・どのような変更を行ったかを追跡可能とする。

### 10.3 データ保護

- **[SEC-006] 通信暗号化**
  - WebアクセスはTLSにより暗号化する（自己署名証明書か商用証明書かは顧客要件に従う）。
- **[SEC-007] 保存データ暗号化【要方式検討】**
  - DBおよびバックアップに保存されるデータの暗号化方式について検討し、必要に応じて適用する。
- **[SEC-008] ログマスキング**
  - ログに個人情報や機微情報が記録される場合、マスキング・トークナイズ等を検討する。

### 10.4 生成AI特有のリスク対策

- **[SEC-009] プロンプトインジェクション対策**
  - システムプロンプトの設計、入力検証、危険な指示の無効化などの対策を講じる。
- **[SEC-010] 禁止トピック制御**
  - 禁止トピックリストをメンテナンスし、違反質問には回答しない。
- **[SEC-011] 根拠提示の標準化**
  - 回答時に可能な限り根拠（参照ナレッジ）を提示することで、検証可能性を確保する。

---

## 11. 運用・保守要件

- **[OPS-001] 運用主体**
  - インフラ運用（ホスト／OS／ネットワーク）、コンテナ実行基盤、バックアップ、監視、アカウント管理は原則として顧客側の責任とする。
  - アプリケーション／設定テンプレートの提供、アップデート提供、既知不具合の修正は提供側の責任とする。
- **[OPS-002] 監視**
  - サービス稼働状況（コンテナ死活監視、リソース使用率等）を監視対象とする。
- **[OPS-003] バックアップ**
  - DBおよびナレッジ・ログを定期的にバックアップする手順を定義する。
- **[OPS-004] 脆弱性対応**
  - フレームワーク／ミドルウェアの脆弱性情報を定期的に確認し、必要なパッチ適用を行う。
- **[OPS-005] インシデント対応**
  - セキュリティインシデント発生時の連絡フロー・初動対応・再発防止策の検討手順を定義する。

---

## 12. 導入・移行要件

- **[DEP-001] 導入プロセス**
  - ヒアリング → 初期構築 → ナレッジ整備 → 検証 → 段階導入 → 運用改善のプロセスで進める。
- **[DEP-002] PoCプラン**
  - 2〜4週間程度の小規模トライアルを標準とし、対象範囲・ナレッジ件数・成功基準を事前に合意する。
  - 成果物として、ログ分析レポート、ナレッジ整備提案、本格導入構成案・費用感（責任分界含む）を提示する。
- **[DEP-003] データ移行**
  - 既存FAQ／マニュアルからのデータ移行方法（テンプレートExcelやCSV取込など）を検討する【要検討】。

---

## 13. リスクと制約

- **[RISK-001] ナレッジ未整備**
  - 自社文書が散在・古い・更新されない場合、RAG精度が出ず期待外れとなるリスク。
  - 初期データ整備支援（FAQ化テンプレ、カテゴリ設計、版管理、更新責任定義）を提供することで緩和する。
- **[RISK-002] 運用が回らない**
  - 更新担当不明・レビュー不在により、導入後に形骸化するリスク。
  - 「登録→レビュー→公開」の簡易フローと更新ルールを標準化し、担当者を明確化する。
- **[RISK-003] セキュリティ懸念による導入中止**
  - 要件不明確なまま検討が進むことで、稟議段階でセキュリティ懸念により却下されるリスク。
  - 本要件定義書およびセキュリティ要件を用いて、導入前から責任分界と最低要件を明示する。

---

## 14. KPI（評価指標）

- **[KPI-001] 一次解決率**
  - 人手介入なしで完了した問い合わせの比率。
- **[KPI-002] 削減工数**
  - 問い合わせ対応時間の削減量（導入前後の比較）。
- **[KPI-003] 未回答率・不適切回答率**
  - 未回答または不適切と判定された回答の比率。
- **[KPI-004] ナレッジ更新回数**
  - 一定期間あたりのナレッジ更新件数（運用が回っているかの指標）。
- **[KPI-005] 利用継続率（解約率）**
  - 月次／年次での継続利用率および解約率。

---

## 15. 参照するガイドライン・標準

- NIST AI RMF 1.0（AIリスクの整理・運用管理）
- OWASP ASVS（Webアプリケーションのセキュア開発要件・検証基準）

